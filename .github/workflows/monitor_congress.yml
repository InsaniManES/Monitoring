name: Monitor Website

on:
  schedule:
    - cron: "*/5 * * * *"  # every 5 minutes
  workflow_dispatch:

jobs:
  check:
    runs-on: ubuntu-latest

    steps:
      - name: Fetch page
        run: |
          curl -s https://www.latino.co.il/r/ > page.html

      - name: Check if keyword exists
        id: check
        run: |
          if grep -q "Registration will be open on 19/2/2026" page.html; then
            echo "status=closed" >> $GITHUB_OUTPUT
          else
            echo "status=open" >> $GITHUB_OUTPUT
          fi

      - name: Send Telegram message if changed
        if: steps.check.outputs.status == 'closed'
        run: |
          curl -s -X POST https://api.telegram.org/bot${{ secrets.BOT_TOKEN }}/sendMessage \
          -d chat_id=${{ secrets.CHAT_ID }} \
          -d text="ðŸš¨ Registration is CLOSED: https://www.latino.co.il/r/"

      - name: Debug
        run: |
          echo "URL is $URL"
          cat page.html | head -20